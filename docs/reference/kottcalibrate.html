<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calibration of replicate weights — kottcalibrate • EVER</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calibration of replicate weights — kottcalibrate" />
<meta property="og:description" content="Adds to a kott.design object the calibrated weights columns (one for each replicate weight, plus one for the initial weights)." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EVER</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calibration of replicate weights</h1>
    
    <div class="hidden name"><code>kottcalibrate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Adds to a <code>kott.design</code> object the calibrated weights columns (one for each replicate weight, plus one for the initial weights).</p>
    </div>

    <pre class="usage"><span class='fu'>kottcalibrate</span>(<span class='no'>deskott</span>, <span class='no'>df.population</span>,
        <span class='kw'>calmodel</span> <span class='kw'>=</span> <span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/class'>inherits</a></span>(<span class='no'>df.population</span>, <span class='st'>"pop.totals"</span>))
                       <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/attr'>attr</a></span>(<span class='no'>df.population</span>, <span class='st'>"calmodel"</span>),
        <span class='kw'>partition</span> <span class='kw'>=</span> <span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/class'>inherits</a></span>(<span class='no'>df.population</span>, <span class='st'>"pop.totals"</span>))
                        <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/attr'>attr</a></span>(<span class='no'>df.population</span>, <span class='st'>"partition"</span>) <span class='kw'>else</span> <span class='fl'>FALSE</span>,
        <span class='kw'>calfun</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"linear"</span>, <span class='st'>"raking"</span>, <span class='st'>"logit"</span>),
        <span class='kw'>bounds</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(-<span class='fl'>Inf</span>, <span class='fl'>Inf</span>), <span class='kw'>aggregate.stage</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>maxit</span> <span class='kw'>=</span> <span class='fl'>50</span>,
        <span class='kw'>epsilon</span> <span class='kw'>=</span> <span class='fl'>1e-07</span>, <span class='kw'>force.rep</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>deskott</th>
      <td><p>Object of class <code>kott.design</code> containing the replicated survey data.</p></td>
    </tr>
    <tr>
      <th>df.population</th>
      <td><p>Data frame containing the known population totals for the auxiliary variables.</p></td>
    </tr>
    <tr>
      <th>calmodel</th>
      <td><p>Formula defining the linear structure of the calibration model.</p></td>
    </tr>
    <tr>
      <th>partition</th>
      <td><p>Formula specifying the variables that define the "calibration domains" for the model (see 'Details'); <code>FALSE</code> (the default) implies no calibration domains.</p></td>
    </tr>
    <tr>
      <th>calfun</th>
      <td><p><code>character</code> specifying the distance function for the calibration process; the default is <code>"linear"</code>.</p></td>
    </tr>
    <tr>
      <th>bounds</th>
      <td><p>Allowed range for the ratios between calibrated and initial weights; the default is <code><a href='https://www.rdocumentation.org/packages/base/topics/c'>c(-Inf,Inf)</a></code>.</p></td>
    </tr>
    <tr>
      <th>aggregate.stage</th>
      <td><p>An integer: if specified, causes the calibrated weights to be constant within sampling units at this stage.</p></td>
    </tr>
    <tr>
      <th>maxit</th>
      <td><p>Maximum number of iterations for the Newton-Raphson algorithm; the default is <code>50</code>.</p></td>
    </tr>
    <tr>
      <th>epsilon</th>
      <td><p>Tolerance for the relative differences between the population totals and the corresponding estimates based on the claibrated weights; the default is <code>10^-7</code>.</p></td>
    </tr>
    <tr>
      <th>force.rep</th>
      <td><p>If <code>TRUE</code>, whenever the calibration algorithm does not converge for a given set of replicate weights, forces the function to return a value (see 'Details'); the default is <code>FALSE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function creates an object of class <code>kott.cal.design</code>. A <code>kott.cal.design</code> object is made up by the union of the (calibrated) replicated survey data and the metadata describing the sampling design. <code>kott.cal.design</code> objects make it possible to estimate the variance of calibration estimators [Deville, Sarndal 92] using the extended <em>"Delete-A-Group Jackknife"</em> method [Kott 2008].</p>
<p>The mandatory argument <code>calmodel</code> symbolically defines the calibration model you want to use, that is - in the language of the generalised regression estimator - the assisting linear regression model underlying the calibration problem [Wilkinson, Rogers 73]. More specifically, the <code>calmodel</code> formula identifies the auxiliary variables and the constraints for the calibration problem. For example, <code>calmodel=~(X+Z):C+(A+B):D</code> defines the calibration problem in which constraints are imposed: (i) on the auxiliary (quantitative) variables <code>X</code> and <code>Z</code> within the subpopulations identified by the (qualitative) classification variable <code>C</code> and, at the same time, (ii) on the absolute frequency of the (qualitative) variables <code>A</code> and <code>B</code> within the subpopulations identified by the (qualitative) classification variable <code>D</code>.<br />
The <code>deskott</code> variables referenced by <code>calmodel</code> must be <code>numeric</code> or <code>factor</code> and must not contain any missing value (<code>NA</code>).</p>
<p>Problems for which one or more qualitative variables can be <em>"factorised"</em> in the formula that specifies the calibration model, are particularly interesting. These variables split the population into non-overlapping subpopulations known as <em>"calibration domains"</em> for the model. An example is provided by the statement <code>calmodel=~(A+B+X+Z):D</code> in which the variable that identifies the calibration domains is <code>D</code>; similarly, the formula <code>calmodel=~(A+B+X+Z):D1:D2</code> identifies as calibration domains the subpopulations determined by crossing the modalities of <code>D1</code> and <code>D2</code>. The interest in models of this kind lies in the fact that the <em>global</em> calibration problem they describe can, actually, be broken down into <em>local</em> subproblems, one per calibration domain, which can be solved separately [Vanderhoeft 01]. Thus, for example, the global problem defined by <code>calmodel=~(A+B+X+Z):D</code> is equivalent to the sequence of problems defined by the <em>"reduced model"</em> <code>calmodel=~A+B+X+Z</code> in each of the domains identified by the modalities of <code>D</code>. The opportunity to separately solve the subproblems related to different calibration domains achieves a significant reduction in computation complexity: the gain increases with increasing survey data size and (most importantly) with increasing auxiliary variables number.</p>
<p>The optional argument <code>partition</code> makes it possible to choose, in cases in which the calibration problem can be factorised, whether to solve the problem globally or iteratively (that is, separately for each calibration domain). The global solution (which is the default option) can be selected invoking the <code>kottcalibrate</code> function with <code>partition=FALSE</code>. To request the iterative solution - a strongly recommended option when dealing with a lot of auxiliary variables and big data sizes - it is necessary to specify via <code>partition</code> the variables defining the calibration domains for the model. If a formula is passed through the <code>partition</code> argument (for example: <code>partition=~D1:D2</code>), the program checks that <code>calmodel</code> actually describes a "reduced model" (for example: <code>calmodel=~X+Z+A+B</code>), that is it does not reference any of the partition variables; if this is not the case, the program stops and prints an error message.<br />
The <code>deskott</code> variables referenced by <code>partition</code> (if any) must be <code>factor</code> and must not contain any missing value (<code>NA</code>).</p>
<p>The mandatory argument <code>df.population</code> is used to specify the known totals of the auxiliary variables referenced by <code>calmodel</code> within the subpopulations (if any) identified by <code>partition</code>. These known totals must be stored in a data frame whose structure (i) depends on the values of <code>calmodel</code> and <code>partition</code> and (ii) must conform to a standard. In order to facilitate understanding of and compliance with this standard, the <span class="pkg">EVER</span> package provides the user with two functions: <code><a href='pop.template.html'>pop.template</a></code> and <code><a href='population.check.html'>population.check</a></code>. The <code>pop.template</code> function is able to guide the user in constructing the known totals data frame for a specific calibration problem, while the <code>population.check</code> function allows to check whether a known totals data frame conforms to the standard required by <code>kottcalibrate</code>. In any case, if the <code>df.population</code> data frame does not comply with the standard, the <code>kottcalibrate</code> function stops and prints an error message: the meaning of the message should help the user diagnose the cause of the problem.</p>
<p>The <code>calfun</code> argument identifies the distance function to be used in the calibration process. Three built-in functions are provided: <code>"linear"</code>, <code>"raking"</code>, and <code>"logit"</code>. The default is <code>"linear"</code>, which corresponds to the euclidean metric.</p>
<p>The <code>bounds</code> argument allows to add <em>"range constraints"</em> to the calibration problem. To be precise, the interval defined by <code>bounds</code> will contain the values of the ratios between final (calibrated) and initial (direct) weights. The default value is <code><a href='https://www.rdocumentation.org/packages/base/topics/c'>c(-Inf,Inf)</a></code>, i.e. no range constraints are imposed. These constraints are optional unless the <code>"logit"</code> function is selected: in the latter case the range defined by <code>bounds</code> has to be finite.</p>
<p>The value passed by the <code>aggregate.stage</code> argument must be an integer between 1 and the number of sampling stages of <code>deskott</code>. If specified, causes the calibrated weights to be constant within sampling units selected at the <code>aggregate.stage</code> stage (actually this is only ensured if the initial weights had already this property, as is sometimes the case in multistage cluster sampling). If not specified, the calibrated weights may differ even for sampling units with identical initial weights. The same holds if some final units belonging to the same cluster selected at the stage <code>aggregate.stage</code> fall in distinct calibration domains (i.e. if the domains defined by <code>partition</code> "cut across" the <code>aggregate.stage</code>-stage clusters).</p>
<p>The <code>maxit</code> argument sets the maximum number of iteration for the Newton-Raphson algorithm that is used to solve the calibration problem. The default value is <code>50</code>.</p>
<p>The <code>epsilon</code> argument determines the convergence criterion for the optimisation algorithm: it fixes the maximum allowed value for the relative differences between the population totals and the corresponding estimates based on the claibrated weights. The default value is <code>10^-7</code>.</p>
<p>If the number of replicates for <code>deskott</code> (the input object of class <code>kott.design</code>) is <code>nrg</code>, the function <code>kottcalibrate</code> is in charge of solving <code>nrg+1</code> distinct calibration problems. In fact, the calibrated weights calculated by <code>kottcalibrate</code> must ensure that the known population totals are exactly reproduced not only by the original sample, but also by all its <code>nrg</code> replicates. Should this requirement fail, the DAGJK method would end up with a biased variance estimator [Kott 2008]. It is, however, possible (more likely when range constraints are imposed) that, for some of the <code>nrg+1</code> distinct calibration problems and for the given values of <code>epsilon</code> and <code>maxit</code>, the solving algorithm does not converge. In this case <code>kottcalibrate</code> by default stops and prints an error message. On the contrary if <code>force.rep = TRUE</code>, <em>provided that the failure to converge pertains only to the replicate weights</em>, the function is forced to return the best approximation achieved for the corresponding calibrated weights. When this occurs, DAGJK standard errors estimates built on the object returned by <code>kottcalibrate</code> will be biased.</p>
    <h2 class="hasAnchor" id="calibration-process-diagnostics"><a class="anchor" href="#calibration-process-diagnostics"></a>Calibration process diagnostics</h2>

    <p>If the number of replicates for <code>deskott</code> is <code>nrg</code>, the function <code>kottcalibrate</code> is in charge of solving <code>nrg+1</code> distinct calibration problems. When, dealing with a factorisable calibration problem, the user selects the iterative solution, each one of the above mentioned problems is split into as many <em>sub-problems</em> as the number of subpopulations defined by <code>partition</code>. A calibration process with such a complex structure needs some ad hoc tool for error diagnostics. For this purpose, every call to <code>kottcalibrate</code> creates, by side effect, a dedicated data structure named <code>kottcal.status</code> into the <code>.GlobalEnv</code>. <code>kottcal.status</code> is a list with two components: the first, <code>"call"</code>, identifies the call to <code>kottcalibrate</code> that generated the list, the second, <code>return.code</code>, is a matrix each element of which identifies the return code of a specific calibration sub-problem. The meaning of the return codes is as follows:</p><dl class='dl-horizontal'>
<dt><code>-1</code></dt><dd><p>not yet tackled sub-problem;</p></dd>
<dt><code>0</code></dt><dd><p>solved sub-problem (convergence achieved);</p></dd>
<dt><code>1</code></dt><dd><p>unsolved sub-problem (no convergence): output forced.</p></dd>
</dl><p>Recall that the latter return code may only occur if <code>force.rep = TRUE</code>.<br />
In case of error, users can exploit <code>kottcal.status</code> to identify the sub-problem from which the error stemmed, hence taking a step forward to eliminate it.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>kott.cal.design</code>. The data frame it contains includes (in addition to the data already stored in <code>deskott</code>) the calibrated weights columns (one for each replicate weight, plus one for the initial weights, <code>nrg+1</code> in all). The names of these columns are obtained by pasting the name of the initial weights column with the string <code>".cal"</code> and the indices <code>NULL, 1, 2, &#8230;, nrg</code>.<br />
The <code>kott.cal.design</code> class is a specialisation of the <code>kott.design</code> class; this means that an object created by <code>kottcalibrate</code> inherits from the <code>data.frame</code> class and you can use on it every method defined on that class.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Deville, J.C., Sarndal, C.E. (1992) <em>"Calibration Estimators in Survey Sampling"</em>, Journal of the American Statistical Association, Vol. 87, No. 418, pp.376-382.</p>
<p>Kott, Phillip S. (2008) <em>"Building a Better Delete-a-Group Jackknife for a Calibration Estimator"</em>, NASS Research Report, NASS: Washington, DC.</p>
<p>Wilkinson, G.N., Rogers, C.E. (1973) <em>"Symbolic Description of Factorial Models for Analysis of Variance"</em>, Journal of the Royal Statistical Society, series C (Applied Statistics), Vol. 22, pp. 181-191.</p>
<p>Vanderhoeft, C. (2001) <em>"Generalized Calibration at Statistic Belgium"</em>, Statistics Belgium Working Paper n. 3, <a href='http://www.statbel.fgov.be/studies/paper03_en.asp'>http://www.statbel.fgov.be/studies/paper03_en.asp</a>.</p>
<p>Lumley, T. (2006) <em>"survey: analysis of complex survey samples"</em>, <a href='http://cran.at.r-project.org/web/packages/survey/index.html'>http://cran.at.r-project.org/web/packages/survey/index.html</a>.</p>
<p>Scannapieco, M., Zardetto, D., Barcaroli, G. (2007) <em>"La Calibrazione dei Dati con R: una Sperimentazione sull'Indagine Forze di Lavoro ed un Confronto con GENESEES/SAS"</em>, Contributi Istat n. 4., <a href='http://www.istat.it/dati/pubbsci/contributi/Contributi/contr_2007/2007_4.pdf'>http://www.istat.it/dati/pubbsci/contributi/Contributi/contr_2007/2007_4.pdf</a>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='desc.html'>desc</a></code> for a concise description of <code>kott.design</code> objects, <code><a href='kottby.html'>kottby</a></code>, <code><a href='kott.ratio.html'>kott.ratio</a></code>, <code><a href='kott.regcoef.html'>kott.regcoef</a></code>, <code><a href='kott.quantile.html'>kott.quantile</a></code> and <code><a href='kottby.user.html'>kottby.user</a></code> for calculating estimates and standard errors, <code><a href='pop.template.html'>pop.template</a></code> for constructing known totals data frames in compliance with the standard required by <code>kottcalibrate</code>, <code><a href='population.check.html'>population.check</a></code> to check that the known totals data frame satisfies that standard, <code><a href='bounds.hint.html'>bounds.hint</a></code> to obtain an hint for range restricted calibration.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Calibration of a kott.design object according to different calibration</span>
<span class='co'># models (the known totals data frames pop01, \ldots, pop05p and the bounds</span>
<span class='co'># vector are contained in the data.examples file).</span>
<span class='co'># For the examples relating to calibration models that can be factorised </span>
<span class='co'># both a global and an iterative solution are given.</span>

<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/data'>data</a></span>(<span class='no'>data.examples</span>)

<span class='co'># Creation of the object to be calibrated:</span>
<span class='no'>kdes</span><span class='kw'>&lt;-</span><span class='fu'><a href='kottdesign.html'>kottdesign</a></span>(<span class='kw'>data</span><span class='kw'>=</span><span class='no'>example</span>,<span class='kw'>ids</span><span class='kw'>=</span>~<span class='no'>towcod</span>+<span class='no'>famcod</span>,<span class='kw'>strata</span><span class='kw'>=</span>~<span class='no'>SUPERSTRATUM</span>,
      <span class='kw'>weights</span><span class='kw'>=</span>~<span class='no'>weight</span>,<span class='kw'>nrg</span><span class='kw'>=</span><span class='fl'>15</span>)


<span class='co'># 1) Calibration on the total number of units in the population</span>
<span class='co'>#   (totals in pop01):</span>
<span class='no'>kdescal01</span><span class='kw'>&lt;-</span><span class='fu'>kottcalibrate</span>(<span class='kw'>deskott</span><span class='kw'>=</span><span class='no'>kdes</span>,<span class='kw'>df.population</span><span class='kw'>=</span><span class='no'>pop01</span>,<span class='kw'>calmodel</span><span class='kw'>=</span>~<span class='fl'>1</span>,
           <span class='kw'>calfun</span><span class='kw'>=</span><span class='st'>"logit"</span>,<span class='kw'>bounds</span><span class='kw'>=</span><span class='no'>bounds</span>,<span class='kw'>aggregate.stage</span><span class='kw'>=</span><span class='fl'>2</span>)

<span class='co'># Checking the result (the function 'ones' is contained</span>
<span class='co'># in the data.examples file):</span>
<span class='fu'><a href='kottby.user.html'>kottby.user</a></span>(<span class='no'>kdescal01</span>,<span class='kw'>user.estimator</span><span class='kw'>=</span><span class='no'>ones</span>)</div><div class='output co'>#&gt; $estimate
#&gt; [1] 918300
#&gt; 
#&gt; $SE
#&gt; [1] 0.004524931
#&gt; </div><div class='input'>

<span class='co'># 2) Calibration on the marginal distributions of sex and marstat</span>
<span class='co'>#    (totals in pop02):</span>
<span class='no'>kdescal02</span><span class='kw'>&lt;-</span><span class='fu'>kottcalibrate</span>(<span class='kw'>deskott</span><span class='kw'>=</span><span class='no'>kdes</span>,<span class='kw'>df.population</span><span class='kw'>=</span><span class='no'>pop02</span>,
           <span class='kw'>calmodel</span><span class='kw'>=</span>~<span class='no'>sex</span>+<span class='no'>marstat</span>-<span class='fl'>1</span>,<span class='kw'>calfun</span><span class='kw'>=</span><span class='st'>"logit"</span>,<span class='kw'>bounds</span><span class='kw'>=</span><span class='no'>bounds</span>,
           <span class='kw'>aggregate.stage</span><span class='kw'>=</span><span class='fl'>2</span>)

<span class='co'># Checking the result:</span>
<span class='fu'><a href='kottby.html'>kottby</a></span>(<span class='no'>kdescal02</span>,~<span class='no'>sex</span>+<span class='no'>marstat</span>)</div><div class='output co'>#&gt; $sex
#&gt;        total          SE
#&gt; sex.f 468366 0.003553678
#&gt; sex.m 449934 0.007568289
#&gt; 
#&gt; $marstat
#&gt;                    total          SE
#&gt; marstat.married   532376 0.009008087
#&gt; marstat.unmarried 311996 0.002435166
#&gt; marstat.widowed    73928 0.001678797
#&gt; </div><div class='input'>

<span class='co'># 3) Calibration (global solution) on the joint distribution of sex</span>
<span class='co'>#    and marstat (totals in pop03):</span>
<span class='no'>kdescal03</span><span class='kw'>&lt;-</span><span class='fu'>kottcalibrate</span>(<span class='kw'>deskott</span><span class='kw'>=</span><span class='no'>kdes</span>,<span class='kw'>df.population</span><span class='kw'>=</span><span class='no'>pop03</span>,
           <span class='kw'>calmodel</span><span class='kw'>=</span>~<span class='no'>marstat</span>:<span class='no'>sex</span>-<span class='fl'>1</span>,<span class='kw'>calfun</span><span class='kw'>=</span><span class='st'>"logit"</span>,<span class='kw'>bounds</span><span class='kw'>=</span><span class='no'>bounds</span>)

<span class='co'># Checking the result:</span>
<span class='fu'><a href='kottby.html'>kottby</a></span>(<span class='no'>kdescal03</span>,~<span class='no'>sex</span>,~<span class='no'>marstat</span>) <span class='co'># or: kottby(kdescal03,~marstat,~sex)</span></div><div class='output co'>#&gt; $married
#&gt;        total          SE
#&gt; sex.f 272172 0.001314645
#&gt; sex.m 260204 0.007915787
#&gt; 
#&gt; $unmarried
#&gt;        total        SE
#&gt; sex.f 159280 0.0076358
#&gt; sex.m 152716 0.0053101
#&gt; 
#&gt; $widowed
#&gt;       total          SE
#&gt; sex.f 36914 0.004295206
#&gt; sex.m 37014 0.001490132
#&gt; </div><div class='input'>
<span class='co'># which, obviously, is not respected by kdescal02 (notice the size of SE):</span>
<span class='fu'><a href='kottby.html'>kottby</a></span>(<span class='no'>kdescal02</span>,~<span class='no'>sex</span>,~<span class='no'>marstat</span>)</div><div class='output co'>#&gt; $married
#&gt;          total       SE
#&gt; sex.f 272101.5 4430.701
#&gt; sex.m 260274.5 4430.700
#&gt; 
#&gt; $unmarried
#&gt;          total       SE
#&gt; sex.f 159235.8 5535.492
#&gt; sex.m 152760.2 5535.491
#&gt; 
#&gt; $widowed
#&gt;          total       SE
#&gt; sex.f 37028.63 2534.089
#&gt; sex.m 36899.37 2534.089
#&gt; </div><div class='input'>

<span class='co'># 3.1) Again a calibration on the joint distribution of sex and marstat</span>
<span class='co'>#      but, this time, with the iterative solution (partition=~sex,</span>
<span class='co'>#      totals in pop03p):</span>
<span class='no'>kdescal03p</span><span class='kw'>&lt;-</span><span class='fu'>kottcalibrate</span>(<span class='kw'>deskott</span><span class='kw'>=</span><span class='no'>kdes</span>,<span class='kw'>df.population</span><span class='kw'>=</span><span class='no'>pop03p</span>,
            <span class='kw'>calmodel</span><span class='kw'>=</span>~<span class='no'>marstat</span>-<span class='fl'>1</span>,<span class='kw'>partition</span><span class='kw'>=</span>~<span class='no'>sex</span>,<span class='kw'>calfun</span><span class='kw'>=</span><span class='st'>"logit"</span>,
            <span class='kw'>bounds</span><span class='kw'>=</span><span class='no'>bounds</span>)

<span class='co'># Checking the result:</span>
<span class='fu'><a href='kottby.html'>kottby</a></span>(<span class='no'>kdescal03p</span>,~<span class='no'>sex</span>,~<span class='no'>marstat</span>)</div><div class='output co'>#&gt; $married
#&gt;        total          SE
#&gt; sex.f 272172 0.001314645
#&gt; sex.m 260204 0.008027662
#&gt; 
#&gt; $unmarried
#&gt;        total          SE
#&gt; sex.f 159280 0.009375013
#&gt; sex.m 152716 0.005521055
#&gt; 
#&gt; $widowed
#&gt;       total          SE
#&gt; sex.f 36914 0.004295206
#&gt; sex.m 37014 0.002508294
#&gt; </div><div class='input'>

<span class='co'># 4) Calibration (global solution) on the totals for the quantitative</span>
<span class='co'>#    variables x1, x2 and x3 in the subpopulations defined by the</span>
<span class='co'>#    regcod variable (totals in pop04):</span>
<span class='no'>kdescal04</span><span class='kw'>&lt;-</span><span class='fu'>kottcalibrate</span>(<span class='kw'>deskott</span><span class='kw'>=</span><span class='no'>kdes</span>,<span class='kw'>df.population</span><span class='kw'>=</span><span class='no'>pop04</span>,
           <span class='kw'>calmodel</span><span class='kw'>=</span>~(<span class='no'>x1</span>+<span class='no'>x2</span>+<span class='no'>x3</span>-<span class='fl'>1</span>):<span class='no'>regcod</span>,<span class='kw'>calfun</span><span class='kw'>=</span><span class='st'>"logit"</span>,
           <span class='kw'>bounds</span><span class='kw'>=</span><span class='no'>bounds</span>,<span class='kw'>aggregate.stage</span><span class='kw'>=</span><span class='fl'>2</span>)

<span class='co'># Checking the result:</span>
<span class='fu'><a href='kottby.html'>kottby</a></span>(<span class='no'>kdescal04</span>,~<span class='no'>x1</span>+<span class='no'>x2</span>+<span class='no'>x3</span>,~<span class='no'>regcod</span>)</div><div class='output co'>#&gt; $x1
#&gt;                  6           7           10
#&gt; total        18403       22484        13726
#&gt; SE    8.719017e-08 0.003661244 6.957057e-05
#&gt; 
#&gt; $x2
#&gt;                  6            7           10
#&gt; total         5870         7557         4884
#&gt; SE    0.0005060036 1.495426e-05 6.312759e-08
#&gt; 
#&gt; $x3
#&gt;                  6            7        10
#&gt; total         6525         8092      5659
#&gt; SE    0.0003954996 0.0003854333 6.295e-05
#&gt; </div><div class='input'>

<span class='co'># 4.1) Same problem with the iterative solution (partition=~regcod,</span>
<span class='co'>#      totals in pop04p):</span>
<span class='no'>kdescal04p</span><span class='kw'>&lt;-</span><span class='fu'>kottcalibrate</span>(<span class='kw'>deskott</span><span class='kw'>=</span><span class='no'>kdes</span>,<span class='kw'>df.population</span><span class='kw'>=</span><span class='no'>pop04p</span>,
            <span class='kw'>calmodel</span><span class='kw'>=</span>~<span class='no'>x1</span>+<span class='no'>x2</span>+<span class='no'>x3</span>-<span class='fl'>1</span>,<span class='kw'>partition</span><span class='kw'>=</span>~<span class='no'>regcod</span>,<span class='kw'>calfun</span><span class='kw'>=</span><span class='st'>"logit"</span>,
            <span class='kw'>bounds</span><span class='kw'>=</span><span class='no'>bounds</span>,<span class='kw'>aggregate.stage</span><span class='kw'>=</span><span class='fl'>2</span>)

<span class='co'># Checking the result:</span>
<span class='fu'><a href='kottby.html'>kottby</a></span>(<span class='no'>kdescal04p</span>,~<span class='no'>x1</span>+<span class='no'>x2</span>+<span class='no'>x3</span>,~<span class='no'>regcod</span>)</div><div class='output co'>#&gt; $x1
#&gt;                  6           7           10
#&gt; total        18403       22484        13726
#&gt; SE    8.719017e-08 0.003473024 7.016744e-05
#&gt; 
#&gt; $x2
#&gt;                  6           7          10
#&gt; total         5870        7557        4884
#&gt; SE    0.0005537555 1.44469e-05 4.93151e-08
#&gt; 
#&gt; $x3
#&gt;                  6           7           10
#&gt; total         6525        8092         5659
#&gt; SE    0.0003681689 0.000367463 6.294953e-05
#&gt; </div><div class='input'>

<span class='co'># 5) Calibration (global solution) on the total for the quantitative</span>
<span class='co'>#    variable x1 and on the marginal distribution of the qualitative</span>
<span class='co'>#    variable age5c, in the subpopulations defined by crossing sex</span>
<span class='co'>#    and marstat (totals in pop05):</span>
<span class='no'>kdescal05</span><span class='kw'>&lt;-</span><span class='fu'>kottcalibrate</span>(<span class='kw'>deskott</span><span class='kw'>=</span><span class='no'>kdes</span>,<span class='kw'>df.population</span><span class='kw'>=</span><span class='no'>pop05</span>,
           <span class='kw'>calmodel</span><span class='kw'>=</span>~(<span class='no'>age5c</span>+<span class='no'>x1</span>-<span class='fl'>1</span>):<span class='no'>sex</span>:<span class='no'>marstat</span>,<span class='kw'>calfun</span><span class='kw'>=</span><span class='st'>"logit"</span>,
           <span class='kw'>bounds</span><span class='kw'>=</span><span class='no'>bounds</span>,<span class='kw'>force.rep</span><span class='kw'>=</span><span class='fl'>TRUE</span>)

<span class='co'># Calibration process diagnostics:</span>
<span class='no'>kottcal.status</span></div><div class='output co'>#&gt; $call
#&gt; kottcalibrate(deskott = kdes, df.population = pop05, calmodel = ~(age5c + 
#&gt;     x1 - 1):sex:marstat, calfun = "logit", bounds = bounds, force.rep = TRUE)
#&gt; 
#&gt; $return.code
#&gt;              global
#&gt; original          0
#&gt; replicate.1       0
#&gt; replicate.2       0
#&gt; replicate.3       0
#&gt; replicate.4       0
#&gt; replicate.5       0
#&gt; replicate.6       0
#&gt; replicate.7       0
#&gt; replicate.8       0
#&gt; replicate.9       0
#&gt; replicate.10      0
#&gt; replicate.11      0
#&gt; replicate.12      0
#&gt; replicate.13      0
#&gt; replicate.14      0
#&gt; replicate.15      0
#&gt; </div><div class='input'>
<span class='co'># Checking the result:</span>
<span class='fu'><a href='kottby.html'>kottby</a></span>(<span class='no'>kdescal05</span>,~<span class='no'>age5c</span>+<span class='no'>x1</span>,~<span class='no'>sex</span>:<span class='no'>marstat</span>)</div><div class='output co'>#&gt; $age5c
#&gt; $age5c$f.married
#&gt;          total           SE
#&gt; age5c.1  11023 3.586120e-07
#&gt; age5c.2  92213 1.631380e-06
#&gt; age5c.3 114859 2.213937e-06
#&gt; age5c.4  47614 8.861208e-07
#&gt; age5c.5   6463 1.887778e-07
#&gt; 
#&gt; $age5c$m.married
#&gt;          total           SE
#&gt; age5c.1   7770 3.405498e-08
#&gt; age5c.2  83894 6.112836e-07
#&gt; age5c.3 122823 8.619858e-07
#&gt; age5c.4  36003 3.571255e-07
#&gt; age5c.5   9714 6.836014e-08
#&gt; 
#&gt; $age5c$f.unmarried
#&gt;         total           SE
#&gt; age5c.1 56857 5.824452e-09
#&gt; age5c.2 45467 1.101849e-08
#&gt; age5c.3 46391 1.202950e-08
#&gt; age5c.4  9573 4.547046e-08
#&gt; age5c.5   992 3.122428e-05
#&gt; 
#&gt; $age5c$m.unmarried
#&gt;         total           SE
#&gt; age5c.1 49705 2.569336e-08
#&gt; age5c.2 50453 4.327043e-08
#&gt; age5c.3 39974 3.159618e-08
#&gt; age5c.4 12122 5.363742e-08
#&gt; age5c.5   462 3.761207e-05
#&gt; 
#&gt; $age5c$f.widowed
#&gt;         total           SE
#&gt; age5c.1  2099 2.931135e-06
#&gt; age5c.2  8122 1.846965e-06
#&gt; age5c.3 16437 1.481764e-05
#&gt; age5c.4  8574 2.317668e-06
#&gt; age5c.5  1682 4.092174e-05
#&gt; 
#&gt; $age5c$m.widowed
#&gt;         total           SE
#&gt; age5c.1   561 1.338078e-05
#&gt; age5c.2 12013 1.009192e-05
#&gt; age5c.3 14556 1.320804e-05
#&gt; age5c.4  8024 1.833614e-05
#&gt; age5c.5  1860 1.031180e-07
#&gt; 
#&gt; 
#&gt; $x1
#&gt;          f.married    m.married  f.unmarried  m.unmarried   f.widowed
#&gt; total        14750        18171         8446         8210        2737
#&gt; SE    5.273801e-06 1.923902e-06 1.820326e-08 1.346842e-07 1.89757e-05
#&gt;          m.widowed
#&gt; total         2298
#&gt; SE    2.971892e-05
#&gt; </div><div class='input'>

<span class='co'># 5.1) Same problem with the iterative solution (partition=~sex:marstat,</span>
<span class='co'>#      totals in pop05p):</span>
<span class='no'>kdescal05p</span><span class='kw'>&lt;-</span><span class='fu'>kottcalibrate</span>(<span class='kw'>deskott</span><span class='kw'>=</span><span class='no'>kdes</span>,<span class='kw'>df.population</span><span class='kw'>=</span><span class='no'>pop05p</span>,
            <span class='kw'>calmodel</span><span class='kw'>=</span>~<span class='no'>age5c</span>+<span class='no'>x1</span>-<span class='fl'>1</span>,<span class='kw'>partition</span><span class='kw'>=</span>~<span class='no'>sex</span>:<span class='no'>marstat</span>,
            <span class='kw'>calfun</span><span class='kw'>=</span><span class='st'>"logit"</span>,<span class='kw'>bounds</span><span class='kw'>=</span><span class='no'>bounds</span>,<span class='kw'>force.rep</span><span class='kw'>=</span><span class='fl'>TRUE</span>)

<span class='co'># Calibration process diagnostics:</span>
<span class='no'>kottcal.status</span></div><div class='output co'>#&gt; $call
#&gt; kottcalibrate(deskott = kdes, df.population = pop05p, calmodel = ~age5c + 
#&gt;     x1 - 1, partition = ~sex:marstat, calfun = "logit", bounds = bounds, 
#&gt;     force.rep = TRUE)
#&gt; 
#&gt; $return.code
#&gt;              f.married f.unmarried f.widowed m.married m.unmarried m.widowed
#&gt; original             0           0         0         0           0         0
#&gt; replicate.1          0           0         0         0           0         0
#&gt; replicate.2          0           0         0         0           0         0
#&gt; replicate.3          0           0         0         0           0         0
#&gt; replicate.4          0           0         0         0           0         0
#&gt; replicate.5          0           0         0         0           0         0
#&gt; replicate.6          0           0         0         0           0         0
#&gt; replicate.7          0           0         0         0           0         0
#&gt; replicate.8          0           0         0         0           0         0
#&gt; replicate.9          0           0         0         0           0         0
#&gt; replicate.10         0           0         0         0           0         0
#&gt; replicate.11         0           0         0         0           0         0
#&gt; replicate.12         0           0         0         0           0         0
#&gt; replicate.13         0           0         0         0           0         0
#&gt; replicate.14         0           0         0         0           0         0
#&gt; replicate.15         0           0         0         0           0         0
#&gt; </div><div class='input'>
<span class='co'># Checking the result:</span>
<span class='fu'><a href='kottby.html'>kottby</a></span>(<span class='no'>kdescal05p</span>,~<span class='no'>age5c</span>+<span class='no'>x1</span>,~<span class='no'>sex</span>:<span class='no'>marstat</span>)</div><div class='output co'>#&gt; $age5c
#&gt; $age5c$f.married
#&gt;          total           SE
#&gt; age5c.1  11023 6.251745e-05
#&gt; age5c.2  92213 5.402141e-04
#&gt; age5c.3 114859 3.276265e-04
#&gt; age5c.4  47614 2.709589e-04
#&gt; age5c.5   6463 1.052340e-05
#&gt; 
#&gt; $age5c$m.married
#&gt;          total           SE
#&gt; age5c.1   7770 0.0007016523
#&gt; age5c.2  83894 0.0001238189
#&gt; age5c.3 122823 0.0001688175
#&gt; age5c.4  36003 0.0001219403
#&gt; age5c.5   9714 0.0004550047
#&gt; 
#&gt; $age5c$f.unmarried
#&gt;         total           SE
#&gt; age5c.1 56857 3.901676e-04
#&gt; age5c.2 45467 2.462598e-04
#&gt; age5c.3 46391 1.929844e-04
#&gt; age5c.4  9573 6.562936e-04
#&gt; age5c.5   992 3.142646e-05
#&gt; 
#&gt; $age5c$m.unmarried
#&gt;         total           SE
#&gt; age5c.1 49705 5.342956e-04
#&gt; age5c.2 50453 8.592134e-04
#&gt; age5c.3 39974 5.908477e-04
#&gt; age5c.4 12122 7.520150e-04
#&gt; age5c.5   462 3.761208e-05
#&gt; 
#&gt; $age5c$f.widowed
#&gt;         total           SE
#&gt; age5c.1  2099 2.931134e-06
#&gt; age5c.2  8122 1.925998e-06
#&gt; age5c.3 16437 1.528427e-05
#&gt; age5c.4  8574 2.388789e-06
#&gt; age5c.5  1682 4.092174e-05
#&gt; 
#&gt; $age5c$m.widowed
#&gt;         total           SE
#&gt; age5c.1   561 1.338078e-05
#&gt; age5c.2 12013 1.009192e-05
#&gt; age5c.3 14556 1.320804e-05
#&gt; age5c.4  8024 1.833614e-05
#&gt; age5c.5  1860 1.031180e-07
#&gt; 
#&gt; 
#&gt; $x1
#&gt;          f.married    m.married  f.unmarried m.unmarried    f.widowed
#&gt; total        14750        18171         8446    8210.001         2737
#&gt; SE    0.0009335519 0.0004246752 0.0005365315 0.002536905 1.959062e-05
#&gt;          m.widowed
#&gt; total         2298
#&gt; SE    2.971892e-05
#&gt; </div><div class='input'>

# Notice that 3.1 e 5.1) do not impose the aggregate.stage=2
# condition. This condition cannot, in fact, be fulfilled because
# in both cases the domains defined by partition "cut across"
# the kdes second stage clusters (households). To compare the results,
# the same choice was also made for 3) e 5).
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#calibration-process-diagnostics">Calibration process diagnostics</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Diego Zardetto</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Diego Zardetto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

